name: Build testing libFMS with intel
  
on:
   - pull_request: main 
   - push:
        tags:
             - '*alpha*'
             - '*beta*'
jobs:
   parallelWorks:
    runs-on: [self-hosted, pw-platform]
    strategy:
      fail-fast: false
      max-parallel: 3
      matrix:
        include:
                - runname: Info checking
                  runscript: python3 /home/Thomas.Robinson/pw/storage/pw_api_python/ARGstartClusters.py ${GITHUB_SHA}
#       include:
#               - runname: FMS with intel8
#                 runscript: python3 /home/Thomas.Robinson/pw/storage/pw_api_python/FMStestStartClusters.py azcluster_noaa
#               - runname: FMS with intel 2021 container
#                 runscript: python3 /home/Thomas.Robinson/pw/storage/pw_api_python/FMSintel21StartClusters.py azcluster_noaa_two
    steps:
                - name: Running intel CI matrix
                  env:
                          RUNNAME: ${{ matrix.runname }}
                          RUNSCRIPT: ${{ matrix.runscript }}
                  run: $RUNSCRIPT
#  ShutDownCluster:
#   runs-on: [self-hosted, pw-platform]
#   if: always()
#   needs: [parallelWorks]
#   strategy:
#     matrix:
#       include:
#               - cluster: azcluster_noaa
#               - cluster: azcluster_noaa_two
#   steps:
#               - name: Turn off cluster
#                 env:
#                         CLUSTER: ${{ matrix.cluster }}
#                 run: python3 /home/Thomas.Robinson/pw/storage/pw_api_python/stopClusters.py $CLUSTER
